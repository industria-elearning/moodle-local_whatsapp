{"version":3,"file":"whatsapp.min.js","sources":["../src/whatsapp.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module watsapp\n *\n * @module     local_whatsapp/whatsapp\n * @copyright  2024 Industria Elearning <info@industriaelearning.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport { renderTemplate } from \"./utils/render\";\n\n/**\n * Init function for render floating whatsapp\n *\n * @param {Object} settings\n * @param {number} settings.phonenumber\n * @param {string} settings.popupmessage\n * @param {string} settings.headertitle\n * @param {boolean} settings.showpopup\n * @param {string} settings.position\n * @param {string} settings.whatsappicon\n * @param {string} settings.sendicon\n */\nexport async function init({\n  phonenumber,\n  popupmessage,\n  headertitle,\n  showpopup,\n  position,\n  whatsappicon,\n  sendicon,\n}) {\n  await renderTemplate(\"local_whatsapp/floating_button\", {\n    popupmessage,\n    headertitle,\n    showpopup,\n    position,\n    whatsappicon,\n    sendicon,\n  });\n  const floatingButton = document.getElementById(\n    \"local_whatsapp_floating_button\"\n  );\n  const closeButton = document.getElementById(\"local_whatsapp_close_button\");\n  const buttonSend = document.getElementById(\"local_whatsapp_button_send\");\n  const inputMessage = document.getElementById(\"local_whatsapp_input_message\");\n\n  floatingButton.addEventListener(\"click\", togglePopup);\n  closeButton.addEventListener(\"click\", togglePopup);\n  buttonSend.addEventListener(\"click\", () => {\n    sendWhatsappMessage({ phonenumber, message: inputMessage.value });\n  });\n  inputMessage.addEventListener(\"keypress\", (event) => {\n    if (event.key === \"Enter\" && !event.shiftKey && !verifyIfMobile()) {\n      event.preventDefault();\n      sendWhatsappMessage({ phonenumber, message: inputMessage.value });\n    }\n  });\n}\n\n/**\n * Send message to whatsapp\n * @param {Object} options\n * @param {number} options.phonenumber\n * @param {string} options.message\n */\nfunction sendWhatsappMessage({ phonenumber, message }) {\n  let apilink = \"http://\";\n  const isMobile = verifyIfMobile();\n  apilink += isMobile ? \"api\" : \"web\";\n  apilink +=\n    \".whatsapp.com/send?phone=\" + phonenumber + \"&text=\" + encodeURI(message);\n\n  window.open(apilink);\n}\n\n/**\n * Check if browser is on a mobile device\n *\n * @returns {boolean} true if mobile or false if not\n */\nfunction verifyIfMobile() {\n  const regex =\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n  return regex.test(navigator.userAgent);\n}\n\n/**\n * Close or open popup\n */\nfunction togglePopup() {\n  const popup = document.getElementById(\"local_whatsapp_popup\");\n  const inputMessage = document.getElementById(\"local_whatsapp_input_message\");\n\n  if (!popup.classList.contains(\"active\")) {\n    popup.classList.add(\"active\");\n    inputMessage.focus();\n  } else {\n    popup.classList.remove(\"active\");\n  }\n}\n"],"names":["sendWhatsappMessage","phonenumber","message","apilink","verifyIfMobile","encodeURI","window","open","test","navigator","userAgent","togglePopup","popup","document","getElementById","inputMessage","classList","contains","remove","add","focus","popupmessage","headertitle","showpopup","position","whatsappicon","sendicon","floatingButton","closeButton","buttonSend","addEventListener","value","event","key","shiftKey","preventDefault"],"mappings":"mGAgFSA,+BAAoBC,YAAEA,YAAFC,QAAeA,eACtCC,QAAU,UAEdA,SADiBC,iBACK,MAAQ,MAC9BD,SACE,4BAA8BF,YAAc,SAAWI,UAAUH,SAEnEI,OAAOC,KAAKJ,kBAQLC,uBAEL,iEACWI,KAAKC,UAAUC,oBAMrBC,oBACDC,MAAQC,SAASC,eAAe,wBAChCC,aAAeF,SAASC,eAAe,gCAExCF,MAAMI,UAAUC,SAAS,UAI5BL,MAAMI,UAAUE,OAAO,WAHvBN,MAAMI,UAAUG,IAAI,UACpBJ,aAAaK;;;;;;;;yBAzEUnB,YACzBA,YADyBoB,aAEzBA,aAFyBC,YAGzBA,YAHyBC,UAIzBA,UAJyBC,SAKzBA,SALyBC,aAMzBA,aANyBC,SAOzBA,qBAEM,0BAAe,iCAAkC,CACrDL,aAAAA,aACAC,YAAAA,YACAC,UAAAA,UACAC,SAAAA,SACAC,aAAAA,aACAC,SAAAA,iBAEIC,eAAiBd,SAASC,eAC9B,kCAEIc,YAAcf,SAASC,eAAe,+BACtCe,WAAahB,SAASC,eAAe,8BACrCC,aAAeF,SAASC,eAAe,gCAE7Ca,eAAeG,iBAAiB,QAASnB,aACzCiB,YAAYE,iBAAiB,QAASnB,aACtCkB,WAAWC,iBAAiB,SAAS,KACnC9B,oBAAoB,CAAEC,YAAAA,YAAaC,QAASa,aAAagB,WAE3DhB,aAAae,iBAAiB,YAAaE,QACvB,UAAdA,MAAMC,KAAoBD,MAAME,UAAa9B,mBAC/C4B,MAAMG,iBACNnC,oBAAoB,CAAEC,YAAAA,YAAaC,QAASa,aAAagB"}